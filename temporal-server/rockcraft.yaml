name: temporal-server
# see https://documentation.ubuntu.com/rockcraft/en/1.11.0/explanation/bases/
# for more information about bases and using 'bare' bases for chiselled rocks
base: ubuntu@24.04 # the base environment for this rock
version: '1.23.1' # just for humans. Semantic versioning is recommended
summary: Rock for Temporal Server # 79 char long summary
description: |
    Temporal is a durable execution platform that enables developers to build scalable applications without sacrificing productivity or reliability. The Temporal server executes units of application logic called Workflows in a resilient manner that automatically handles intermittent failures, and retries failed operations.

platforms: # the platforms this rock should be built on and run on
    amd64:

services:
    temporal-server:
        command: /start_temporal_server.sh
        override: replace
        startup: enabled
        user: ubuntu

parts:
    temporal:
        plugin: go
        source: https://github.com/temporalio/temporal
        source-subdir: cmd/server 
        source-type: git
        source-tag: v1.23.1
        build-snaps:
            - go/1.21/stable
        organize:
            bin/server: bin/temporal-server
            LICENSE: licenses/LICENSE-temporal
    temporal-cli:
        plugin: go
        source: https://github.com/temporalio/cli.git
        source-type: git
        source-tag: v1.3.0
        build-snaps:
            - go/1.24/stable
        organize:
            LICENSE: licences/LICENSE-temporal-cli
    temporal-scripts:
        plugin: dump
        source: scripts
        source-type: local
        stage:
            - licenses/LICENSE-rock
        organize:
            LICENSE: licenses/LICENSE-rock